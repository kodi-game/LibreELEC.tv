From fd4d3a003930a4ae4a9e3783a87c68328984f275 Mon Sep 17 00:00:00 2001
From: Garrett Brown <themagnificentmrb@gmail.com>
Date: Wed, 31 Jul 2019 00:10:10 -0700
Subject: [PATCH 2/3] RetroPlayer/GLES: Use no-alpha texture shader

Fixes black screen with RGB emulators on RPi.
---
 xbmc/cores/RetroPlayer/rendering/RenderContext.cpp              | 1 +
 xbmc/cores/RetroPlayer/rendering/RenderContext.h                | 1 +
 .../RetroPlayer/rendering/VideoRenderers/RPRendererOpenGLES.cpp | 2 +-
 3 files changed, 3 insertions(+), 1 deletion(-)

diff --git a/xbmc/cores/RetroPlayer/rendering/RenderContext.cpp b/xbmc/cores/RetroPlayer/rendering/RenderContext.cpp
index 7f7a6c5f07..b5759897bd 100644
--- a/xbmc/cores/RetroPlayer/rendering/RenderContext.cpp
+++ b/xbmc/cores/RetroPlayer/rendering/RenderContext.cpp
@@ -74,6 +74,7 @@ static ESHADERMETHOD TranslateShaderMethod(GL_SHADER_METHOD method)
   case GL_SHADER_METHOD::TEXTURE: return SM_TEXTURE;
 #if defined(HAS_GLES)
   case GL_SHADER_METHOD::TEXTURE_RGBA_OES: return SM_TEXTURE_RGBA_OES;
+  case GL_SHADER_METHOD::TEXTURE_NOALPHA: return SM_TEXTURE_NOALPHA;
 #endif
   default:
     break;
diff --git a/xbmc/cores/RetroPlayer/rendering/RenderContext.h b/xbmc/cores/RetroPlayer/rendering/RenderContext.h
index 076d955fbb..91fbb49617 100644
--- a/xbmc/cores/RetroPlayer/rendering/RenderContext.h
+++ b/xbmc/cores/RetroPlayer/rendering/RenderContext.h
@@ -27,6 +27,7 @@ enum class GL_SHADER_METHOD
   DEFAULT,
   TEXTURE,
   TEXTURE_RGBA_OES,
+  TEXTURE_NOALPHA,
 };
 
 namespace KODI
diff --git a/xbmc/cores/RetroPlayer/rendering/VideoRenderers/RPRendererOpenGLES.cpp b/xbmc/cores/RetroPlayer/rendering/VideoRenderers/RPRendererOpenGLES.cpp
index c5cee3ae28..b01c89ce8b 100644
--- a/xbmc/cores/RetroPlayer/rendering/VideoRenderers/RPRendererOpenGLES.cpp
+++ b/xbmc/cores/RetroPlayer/rendering/VideoRenderers/RPRendererOpenGLES.cpp
@@ -255,7 +255,7 @@ void CRPRendererOpenGLES::Render(uint8_t alpha)
   glTexParameteri(m_textureTarget, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE);
   glTexParameteri(m_textureTarget, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE);
 
-  m_context.EnableGUIShader(GL_SHADER_METHOD::TEXTURE);
+  m_context.EnableGUIShader(GL_SHADER_METHOD::TEXTURE_NOALPHA);
 
   GLubyte colour[4];
   GLubyte idx[4] = {0, 1, 3, 2}; // Determines order of triangle strip
-- 
2.20.1

